/*! author: Junhong-Chen */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CanvasOrgChart=e():t.CanvasOrgChart=e()}(window,(function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=7)}([function(t,e,i){var n=i(11),r=i(12),o=i(3),a=i(13);t.exports=function(t){return n(t)||r(t)||o(t)||a()}},function(t,e){t.exports=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}},function(t,e){function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}},function(t,e,i){var n=i(4);t.exports=function(t,e){if(t){if("string"==typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(t,e):void 0}}},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}},function(t,e,i){var n=i(8),r=i(9),o=i(3),a=i(10);t.exports=function(t,e){return n(t)||r(t,e)||o(t,e)||a()}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return g}));var n=i(5),r=i.n(n),o=i(0),a=i.n(o),h=i(6),d=i.n(h),s=i(2),l=i.n(s),c=i(1),u=i.n(c);function f(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return y(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return y(t,e)}(t))){var e=0,i=function(){};return{s:i,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r,o=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){a=!0,r=t},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw r}}}}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var g=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{node:{}};d()(this,t),u()(this,"_lastClickNode",null),u()(this,"_isFindNode",!1),u()(this,"_chartWidth",0),u()(this,"_chartHeight",0),this.canvas=e;var n=i.scale;this.scale=void 0===n?[1,1]:n;var r=i.padding;this.padding=void 0===r?[0,0,0,0]:r;var o=i.nodeTemplate;this.nodeTemplate=void 0===o?[]:o;var a=i.defaultAvatar;this.defaultAvatar=void 0===a?"":a;var h=i.width;this.width=void 0===h?0:h;var s=i.height;this.height=void 0===s?0:s;var l=i.node||{},c=l.spacing;this.nodeSpacing=void 0===c?[20,20]:c;var f=l.color;this.nodeColor=void 0===f?"white":f;var y=l.background;this.nodeBackground=void 0===y?"cornflowerblue":y;var g=l.customBackgrounds;this.nodeCustomBackgrounds=void 0===g?[]:g;var v=l.customAvatar;this.customAvatar=void 0===v?null:v;var p=l.width;this.nodeWidth=void 0===p?60:p;var m=l.height;this.nodeHeight=void 0===m?160:m,this.formatParams(),this.originX=parseInt(i.originX)||0+this.padding[3],this.originY=parseInt(i.originY)||0+this.padding[0],this.ctx=null,this._chartWidth=this.originX,this.verifyParameter()}return l()(t,[{key:"currentSelected",get:function(){return this._lastClickNode}}]),l()(t,[{key:"verifyParameter",value:function(){if(!(this.canvas&&this.canvas instanceof HTMLElement))throw new Error("Please pass a valid canvas.");if(!Array.isArray(this.nodeCustomBackgrounds))throw new TypeError("nodeCustomBackgrounds must be an array.");if(!Array.isArray(this.padding)||this.padding.length<1)throw new TypeError("padding must be an non-empty array.");if(!Array.isArray(this.nodeSpacing)||this.nodeSpacing.length<1)throw new TypeError("nodeSpacing must be an non-empty array.");if(!Array.isArray(this.scale))throw new TypeError("scale must be an array.");if("string"!=typeof this.nodeBackground)throw new TypeError("nodeBackground must be a string.");if("number"!=typeof this.width||"number"!=typeof this.height||"number"!=typeof this.nodeWidth||"number"!=typeof this.nodeHeight)throw new TypeError("width or height must be a number.");if("function"!=typeof this.nodeTemplate&&!Array.isArray(this.nodeTemplate))throw new TypeError("customNode must be a function or an array.")}},{key:"formatParams",value:function(){switch(this.padding.length){case 1:this.padding[1]=this.padding[0],this.padding[2]=this.padding[0],this.padding[3]=this.padding[0];break;case 2:this.padding[2]=this.padding[0],this.padding[3]=this.padding[1];break;case 3:this.padding[3]=this.padding[1]}1===this.nodeSpacing.length&&(this.nodeSpacing[1]=this.nodeSpacing[0])}},{key:"render",value:function(t){var e,i=this.canvas;if(!i.getContext)throw new Error("can't get canvas context.");if(this.ctx=i.getContext("2d"),!t)throw new Error("data can't be empty.");this.nodeTemplate===[]?this.calculateCoordinate(t,this.originY):this.calculateCustomCoordinate(t,this.originY),this._chartWidth-=this.nodeSpacing[0],this._chartHeight+=this.nodeHeight,this.setCanvasSize(i,this.width||this._chartWidth+this.padding[1],this.height||this._chartHeight+this.padding[2]),(e=this.ctx).scale.apply(e,a()(this.scale)),this.drawChart(this.ctx,t,!1),this.bindClick(i,t)}},{key:"calculateCoordinate",value:function(t,e){var i=t.children.length;if(t.y=e,t.y>this._chartHeight&&(this._chartHeight=t.y),i<=0)t.x=this._chartWidth,this._chartWidth+=this.nodeWidth+this.nodeSpacing[0];else{e+=this.nodeHeight+this.nodeSpacing[1];var n,r=f(t.children);try{for(r.s();!(n=r.n()).done;){var o=n.value;this.calculateCoordinate(o,e)}}catch(t){r.e(t)}finally{r.f()}t.x=1===i?t.children[0].x:Math.round(t.children[0].x+(t.children[i-1].x-t.children[0].x)/2)}}},{key:"calculateCustomCoordinate",value:function(t,e){var i=t.children.length;if(t.y=e,Array.isArray(this.nodeTemplate)&&this.nodeTemplate.length>0){var n,o=f(this.nodeTemplate.entries());try{for(o.s();!(n=o.n()).done;){var a=r()(n.value,2),h=a[0],d=a[1];if(d.checkOwn&&Object.prototype.hasOwnProperty.call(t,d.attributeName)||t[d.attributeName]){t._isCustom=h,t._width=d.width,t._height=d.height;break}}}catch(t){o.e(t)}finally{o.f()}}if(t.y>this._chartHeight&&(this._chartHeight=t.y),i<=0)t.x=this._chartWidth,this._chartWidth+=(t._width||this.nodeWidth)+this.nodeSpacing[0];else{e+=this.nodeHeight+this.nodeSpacing[1];var s,l=f(t.children);try{for(l.s();!(s=l.n()).done;){var c=s.value;this.calculateCustomCoordinate(c,e)}}catch(t){l.e(t)}finally{l.f()}if(1===i)t.x=t.children[0].x;else{var u=((t.children[0]._width||this.nodeWidth)-this.nodeWidth)/2-((t._width||this.nodeWidth)-this.nodeWidth)/2;t.x=Math.round(t.children[0].x+(t.children[i-1].x-t.children[0].x)/2+u)}}}},{key:"drawChart",value:function(t,e){"function"==typeof this.nodeTemplate?this.nodeTemplate(this,t,e.x,e.y,e):void 0!==e._isCustom?this.nodeTemplate[e._isCustom].draw(this,t,e.x,e.y,e):this.drawNode(t,e.x,e.y,e),this.drawNodeLine(t,e)}},{key:"drawNode",value:function(t,e,i,n){this.drawAvatar(t,e,i,n),t.fillStyle=this.nodeBackground;var r,o=f(this.nodeCustomBackgrounds);try{for(o.s();!(r=o.n()).done;){var a=r.value;(a.checkOwn&&Object.prototype.hasOwnProperty.call(n,a.attributeName)||void 0!==n[a.attributeName])&&("string"==typeof a.color?t.fillStyle=a.color:t.fillStyle=a.color[n[a.attributeName]])}}catch(t){o.e(t)}finally{o.f()}var h=this.nodeHeight-this.nodeWidth;t.fillRect(e,i+this.nodeWidth,this.nodeWidth,h),t.stroke(),this.drawVerticalText(t,e,i+this.nodeWidth,n._width||this.nodeWidth,h,n.name)}},{key:"drawAvatar",value:function(t,e,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.nodeWidth,o=new Image,a=this;n.avatar?o.src=n.avatar:this.customAvatar&&Object.prototype.hasOwnProperty.call(n,this.customAvatar.attributeName)?o.src=this.customAvatar.avatars[n[this.customAvatar.attributeName]]:o.src=this.defaultAvatar,o.onload=function(){t.drawImage(this,e,i,r,r)},o.onerror=function(){a.drawImageError(t,e,i,r,r)}}},{key:"drawVerticalText",value:function(t,e,i,n,r,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:10,h=22,d=(r-o.length*h-a)/(o.length-1);t.font="".concat(h,"px serif"),t.textBaseline="bottom",t.fillStyle=this.nodeColor,e+=n/2-h/2,i+=h+a/2;var s,l=f(o.split(""));try{for(l.s();!(s=l.n()).done;){var c=s.value;t.fillText(c,e,i),i+=h+d}}catch(t){l.e(t)}finally{l.f()}}},{key:"drawNodeLine",value:function(t,e){var i=e.children.length;this.drawSelected(t,e,e._width||this.nodeWidth,e._height||this.nodeHeight,!0),t.strokeStyle="black",t.lineCap="butt";var n=e.x+(e._width||this.nodeWidth)/2;if(e.y>this.originY&&this.drawLine(t,[n,e.y-2],[n,e.y-this.nodeSpacing[1]/2]),i>0){var r=e.y+(e._height||this.nodeHeight);this.drawLine(t,[n,r+2],[n,r+this.nodeSpacing[1]/2+this.nodeHeight-(e._height||this.nodeHeight)]);var o=e.y+this.nodeHeight+this.nodeSpacing[1]/2+1;this.drawLine(t,[e.children[0].x+(e.children[0]._width||this.nodeWidth)/2,o],[e.children[i-1].x+(e.children[i-1]._width||this.nodeWidth)/2,o]);var a,h=f(e.children);try{for(h.s();!(a=h.n()).done;){var d=a.value;this.drawChart(t,d)}}catch(t){h.e(t)}finally{h.f()}}}},{key:"drawSelected",value:function(t,e,i,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=e.x-1,a=e.y-1;i+=2,n+=2,t.lineCap="round",t.strokeStyle=r?"white":"black",this.drawLine(t,[o,a],[o+i,a]),this.drawLine(t,[o+i,a],[o+i,a+n]),this.drawLine(t,[o+i,a+n],[o,a+n]),this.drawLine(t,[o,a+n],[o,a])}},{key:"drawLine",value:function(t,e,i){t.beginPath(),t.lineWidth=2,t.moveTo.apply(t,a()(e)),t.lineTo.apply(t,a()(i)),t.stroke()}},{key:"setCanvasSize",value:function(t,e,i){t.setAttribute("width",e),t.setAttribute("height",i)}},{key:"bindClick",value:function(t,e){var i=this;t.addEventListener("click",(function(t){var n=this.getBoundingClientRect(),r=(t.clientX-n.left)/i.scale[0],o=(t.clientY-n.top)/i.scale[1];i.isPointInRect([i.originX,i.originY],i._chartWidth-i.padding[3],i._chartHeight-i.padding[0],r,o)?i._lastClickNode&&i.isPointInRect([i._lastClickNode.x,i._lastClickNode.y],i._lastClickNode._width||i.nodeWidth,i._lastClickNode._height||i.nodeHeight,r,o)||(i._isFindNode=!1,i.isClickNode(e,r,o),i._isFindNode||(i._lastClickNode&&i.drawSelected(i.ctx,i._lastClickNode,i._lastClickNode._width||i.nodeWidth,i._lastClickNode._height||i.nodeHeight,!0),i._lastClickNode=null)):(i._lastClickNode&&i.drawSelected(i.ctx,i._lastClickNode,i._lastClickNode._width||i.nodeWidth,i._lastClickNode._height||i.nodeHeight,!0),i._lastClickNode=null)}))}},{key:"isClickNode",value:function(t,e,i){if(this.isPointInRect([t.x,t.y],t._width||this.nodeWidth,t._height||this.nodeHeight,e,i))return this._lastClickNode&&this.drawSelected(this.ctx,this._lastClickNode,this._lastClickNode._width||this.nodeWidth,this._lastClickNode._height||this.nodeHeight,!0),this._lastClickNode=t,this._isFindNode=!0,void this.drawSelected(this.ctx,t,this._lastClickNode._width||this.nodeWidth,this._lastClickNode._height||this.nodeHeight);if(t.children.length>0&&!this._isFindNode){var n,r=f(t.children);try{for(r.s();!(n=r.n()).done;){var o=n.value;this.isClickNode(o,e,i)}}catch(t){r.e(t)}finally{r.f()}}}},{key:"isPointInRect",value:function(t,e,i,n,r){var o={x:n,y:r},a={x:t[0],y:t[1]},h={x:t[0]+e,y:t[1]},d={x:t[0]+e,y:t[1]+i},s={x:t[0],y:t[1]+i};return this.getCrossProduct(o,a,h)*this.getCrossProduct(o,d,s)>=0&&this.getCrossProduct(o,h,d)*this.getCrossProduct(o,s,a)>=0}},{key:"getCrossProduct",value:function(t,e,i){return(i.x-e.x)*(t.y-e.y)-(t.x-e.x)*(i.y-e.y)}},{key:"drawImageError",value:function(t,e,i,n,r){var o=r/2,a=n/5.5,h=n/4,d=n/14;t.beginPath(),t.fillStyle="darkgray",t.strokeStyle="white",t.fillRect(e,i,n,r),t.fillStyle="white",t.font="".concat(h,"px arial"),t.fillText("暂无",e+h/3,i+h/2*3),t.fillText("图片",e+h/3,i+h/2*5),t.arc(e+n-a,i+r/4,h/3,0,2*Math.PI);var s=i+r-o/2;t.lineWidth=2,t.moveTo(e+0,i+r),t.lineTo(e+a,s),this.drawMountain(t,[e+a,s],[e+2*a,s],d),this.drawMountain(t,[e+2*a,s],[e+3*a,s],d,!0),t.lineTo(e+4*a,i+r-o),this.drawMountain(t,[e+4*a,i+r-o],[e+5*a,i+r-o],d),t.lineTo(e+n,i+r-o+.6*a),t.stroke(),t.closePath()}},{key:"drawMountain",value:function(t,e,i,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];r&&(n*=-1),t.moveTo.apply(t,a()(e));var o={x:e[0]+(i[0]-e[0])/4,y:e[1]-n},h={x:i[0]-(i[0]-e[0])/4,y:i[1]-n};t.bezierCurveTo.apply(t,[o.x,o.y,h.x,h.y].concat(a()(i)))}}]),t}()},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var i=[],n=!0,r=!1,o=void 0;try{for(var a,h=t[Symbol.iterator]();!(n=(a=h.next()).done)&&(i.push(a.value),!e||i.length!==e);n=!0);}catch(t){r=!0,o=t}finally{try{n||null==h.return||h.return()}finally{if(r)throw o}}return i}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e,i){var n=i(4);t.exports=function(t){if(Array.isArray(t))return n(t)}},function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}}])}));